{
  "description": "Before provisioning rule operations for eCare OpenLDAP Source.",
  "type": "BeforeProvisioning",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "2022-10-04 01:05:14",
    "script": "\nimport sailpoint.object.*;\nimport sailpoint.object.ProvisioningPlan.AccountRequest;\nimport sailpoint.object.ProvisioningPlan.AttributeRequest;\nimport sailpoint.tools.Util;\nimport java.util.Date;\nimport java.util.Calendar;\nimport java.lang.String;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.text.SimpleDateFormat;\n\npublic AttributeRequest newAttributeRequest(String attributeName, Object attributeValue) \n{\n  AttributeRequest attributeRequest = new ProvisioningPlan.AttributeRequest();\n  attributeRequest.setName(attributeName);\n  attributeRequest.setOperation(ProvisioningPlan.Operation.Set);\n  attributeRequest.setValue(attributeValue);\n  return attributeRequest;\n}\n\nif(plan != null) {\n    Identity identity = plan.getIdentity();\n    String lifecycleState = null;\n\n    // Get the identity from the plan and perform operations\n    if(identity != null) {\n\n        List accountRequests = plan.getAccountRequests();\n        lifecycleState = identity.getAttribute(\"cloudLifecycleState\");\n\n        if(accountRequests != null && !accountRequests.isEmpty()) {\n\n            for(AccountRequest accountRequest : accountRequests) {\n                AccountRequest.Operation op = accountRequest.getOperation();\n                String nativeIdentity = accountRequest.getNativeIdentity();\n \n \n                if( op == null ) continue;\n                if( op == AccountRequest.Operation.Modify && nativeIdentity != null) {\n                    AttributeRequest hphcroleRequest = acctReq.getAttributeRequest(\"hphcrole\");\n                    if(hphcroleRequest != null && hphcroleRequest.getOperation().equals(ProvisioningPlan.Operation.Add) ){\n                        Account account = idn.getAccountByNativeIdentity(application.getName(), nativeIdentity);\n                        if (account != null){\n                            String oldHphcRole = idn.getAccountAttribute(\"hphcrole\");\n                            AttributeRequest oldHphcRoleReq = new AttributeRequest(\"hphcrole\", ProvisioningPlan.Operation.Remove, oldHphcRole);\n                            accountRequest.add(oldHphcRoleReq);\n\n                        }\n                    }\n                }\n                else if( op == AccountRequest.Operation.Enable && \"removeaccess\".equalsIgnoreCase(lifecycleState) && nativeIdentity != null){\n                    accountRequest.setOperation(AccountRequest.Operation.Delete);\n                }\n                else if( op == AccountRequest.Operation.Disable && \"inactive\".equalsIgnoreCase(lifecycleState) && nativeIdentity != null){\n                    SimpleDateFormat SDFormat = new SimpleDateFormat(\"MM/dd/yyyy\");\n                    Calendar cal = Calendar.getInstance();\n                    String currentDate = SDFormat.format(cal.getTime());\n                    log.info(\"eCare BP Rule - Set TodaysDate to: \"+ currentDate +\" for Identity - \"+ identity.getName() +\" :: [eCare_PROV] Mark Account as Termd.\");\n                    accountRequest.add(new AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, \"Account Disabled on \" + currentDate));\n                    accountRequest.add(new AttributeRequest(\"msDS-UserAccountDisabled\", ProvisioningPlan.Operation.Set, \"True\"));\n                }\n                else if( op == AccountRequest.Operation.Enable && (\"active\".equalsIgnoreCase(lifecycleState) || \"prehire\".equalsIgnoreCase(lifecycleState))){\n                    log.info(\"eCare BP Rule: for Identity - \"+ identity.getName() +\" :: [OUD_PROV] Re-Enable Account.\");\n                    accountRequest.add(new AttributeRequest(\"msDS-UserAccountDisabled\", ProvisioningPlan.Operation.Set, \"\"));\n                }\n            }\n        }\n    }\n}\n"
  },
  "attributes": {
    "sourceVersion": "2022-10-04 01:05:14"
  },
  "id": "9f1b5ade93a74ebd9ae06291e6792d48",
  "name": "eCare BeforeProvisioning",
  "created": "2022-10-04T01:05:15.004Z",
  "modified": "2024-04-17T19:16:03.375Z"
}