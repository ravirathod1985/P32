{
  "description": "Executes PowerShell commands on the IQService component before a source account is modified.",
  "type": "ConnectorBeforeModify",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "1.0",
    "script": "$logDate = Get-Date -UFormat \"%Y%m%d\"\r\n$logFile = \"E:\\SailPoint\\Scripts\\Logs\\P32_ConnectorBeforeModify_$logDate.log\"\r\n#$command = \"E:\\SailPoint\\Scripts\\AfterModify.ps1\"\r\n$enableDebug = $true\r\n#====================-------Helper functions-------====================\r\nfunction LogToFile([String] $info) {\r\n  $info | Out-File $logFile -Append\r\n}\r\n#====================-------Get the request object-------====================\r\nTry{\r\n\t  if($enableDebug) {\r\n\t\t  $timestampString = (Get-Date -Format \"yyyy-MM-dd_HH-mm-ss\").ToString()\r\n\t\t  LogToFile(\"[$timestampString] P32_BeforeModify: Entering P32_BeforeModify rule\")\r\n\t  }\r\n\t  Add-type -path utils.dll;\r\n\t  $sReader = New-Object System.IO.StringReader([System.String]$env:Request);\r\n\t  $xmlReader = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sReader));\r\n\t  $requestObject = New-Object Sailpoint.Utils.objects.AccountRequest($xmlReader);\r\n\t  $requestAsString = $env:Request\r\n\t  $op = $requestObject.Operation\r\n\t  \r\n\t  $nativeIdentity = $requestObject.nativeIdentity\r\n\t  foreach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\tif($attribute.Name -eq \"sAMAccountName\") {\r\n\t\t\t\t$sAMAccountName = $attribute.value\r\n\t\t\t}\r\n\t  }\r\n\r\n\t  if($enableDebug) {\r\n\t\t  LogToFile(\"P32_BeforeModify: Request as XML object is: $requestAsString\")\r\n\t  }\r\n\t  \r\n\t  if ($op -eq \"Modify\") {\r\n\t\t\t LogToFile(\"P32_BeforeModify - Execute Modify Operation Scripts\")\r\n\t\t\t #$output = Invoke-Expression $command\r\n\t  }\r\n\t   if ($op -eq \"Disable\") {\r\n\t\t\t LogToFile(\"P32_BeforeModify - Execute Disable Operation Scripts\")\r\n\t\t\t #$output = Invoke-Expression $command\r\n\t  }\r\n\r\n}Catch{\r\n  $ErrorMessage = $_.Exception.Message\r\n  $ErrorItem = $_.Exception.ItemName\r\n  if($enableDebug) {\r\n\t  LogToFile(\"P32_BeforeModify: Error: Item = $ErrorItem -> Message = $ErrorMessage\")\r\n  }\r\n}\r\nif($enableDebug) {\r\n  $timestampString = (Get-Date -Format \"yyyy-MM-dd_HH-mm-ss\").ToString()\r\n  LogToFile(\"[$timestampString] P32_BeforeModify: Exiting P32_BeforeModify rule\")\r\n}"
  },
  "attributes": {
    "ObjectOrientedScript": "true",
    "extension": ".ps1",
    "sourceVersion": "1.0",
    "disabled": "false",
    "program": "powershell.exe",
    "timeout": "300"
  },
  "id": "5e7bd656c8fb4f72973754053cb1c1cf",
  "name": "Rule - P32 ActiveDirectory - BeforeModify",
  "created": "2024-04-02T10:01:15.830Z",
  "modified": "2024-04-17T19:16:03.279Z"
}